# ChainRate-PMP 系统说明文档

## 1. 系统概述

ChainRate-PMP 是一个基于区块链技术的课程反馈与评价系统，旨在为学生和教师提供一个透明、可信的平台，用于提交、管理和查看课程反馈。系统使用以太坊智能合约确保数据的不可篡改性，并利用 IPFS 存储内容和附件，实现了分布式的内容存储。

## 2. 主要功能

### 学生端功能

1. **课程管理**
   - 查看已选课程列表
   - 加入新课程
   - 查看课程详情

2. **反馈管理**
   - 提交新的课程反馈
   - 编辑已提交的反馈
   - 查看教师回复
   - 按状态筛选反馈
   - 按时间或状态排序反馈
   - 搜索反馈内容

3. **文件管理**
   - 上传图片附件
   - 上传文档附件
   - 查看版本历史

### 教师端功能

1. **课程管理**
   - 创建新课程
   - 管理课程学生
   - 查看课程统计数据

2. **反馈回复**
   - 查看学生反馈
   - 回复学生反馈
   - 按课程筛选反馈
   - 查看反馈版本历史

## 3. 技术架构

### 前端技术

- **框架**: Next.js (React)
- **UI 组件库**: Ant Design
- **状态管理**: React Hooks
- **路由**: Next.js Router
- **数据请求**: Axios

### 后端技术

- **区块链**: 以太坊 (Ethereum)
- **智能合约**: Solidity
- **合约交互**: ethers.js
- **文件存储**: IPFS (InterPlanetary File System)
- **IPFS 接口**: Pinata API

### 主要合约

- **ChainRate**: 主合约，管理用户信息、课程信息等基础数据
- **ChainRate02**: 扩展合约，处理课程反馈、评价等功能

## 4. 功能详解

### 4.1 反馈编辑功能

学生可以对已提交的反馈进行编辑。编辑过程会保留历史版本，方便追踪修改。

**编辑反馈流程**:
1. 在反馈列表中点击"编辑反馈"按钮
2. 在弹出的模态框中修改反馈内容
3. 可以添加或删除附件（图片、文档）
4. 提交修改后，系统会调用智能合约的 `updateCourseFeedback` 方法
5. 所有修改都会上传到 IPFS，并将哈希存储在区块链上
6. 成功后会显示在反馈列表中，并标记为"已修改"状态

**技术实现**:
- 使用 Modal 组件实现编辑界面
- 通过 Upload 组件处理文件上传
- 使用 IPFS (Pinata API) 存储内容和附件
- 通过智能合约记录反馈版本

### 4.2 反馈版本历史

系统会记录反馈的所有修改版本，方便教师查看反馈的演变过程。

**查看版本历史流程**:
1. 在反馈详情页点击"版本历史"选项卡
2. 系统会显示所有历史版本，按时间降序排列
3. 每个版本都会显示修改时间、内容和附件信息

**技术实现**:
- 使用 Timeline 组件展示版本历史
- 通过智能合约的 `getFeedbackVersion` 方法获取版本信息
- 从 IPFS 加载历史内容

## 5. 使用指南

### 5.1 学生用户

1. **登录系统**
   - 使用 MetaMask 钱包登录
   - 确保钱包中有足够的以太币支付交易费用

2. **提交反馈**
   - 进入"我的反馈"页面
   - 点击"新建反馈"按钮
   - 选择课程
   - 填写反馈内容
   - 上传附件（可选）
   - 提交反馈

3. **编辑反馈**
   - 在反馈列表中找到需要编辑的反馈
   - 点击"编辑反馈"按钮
   - 在弹出的模态框中修改内容
   - 点击"提交修改"按钮

4. **查看教师回复**
   - 进入反馈详情
   - 点击"教师回复"选项卡
   - 查看教师的回复内容

### 5.2 教师用户

1. **登录系统**
   - 使用 MetaMask 钱包登录
   - 确保钱包中有足够的以太币支付交易费用

2. **查看学生反馈**
   - 进入"学生反馈"页面
   - 按课程筛选反馈
   - 点击"查看详情"查看反馈内容

3. **回复反馈**
   - 在反馈详情页点击"回复"按钮
   - 填写回复内容
   - 提交回复

## 6. 部署指南

### 6.1 前端部署

1. 安装依赖:
```bash
npm install
```

2. 配置环境变量:
```
NEXT_PUBLIC_PINATA_JWT=your_pinata_jwt_token
```

3. 开发模式运行:
```bash
npm run dev
```

4. 构建生产版本:
```bash
npm run build
npm start
```

### 6.2 智能合约部署

1. 使用 Remix 或 Truffle 部署合约到以太坊网络
2. 更新 `ChainRate-address.json` 和 `ChainRate02-address.json` 中的合约地址

## 7. 常见问题

1. **交易失败**
   - 确保 MetaMask 钱包有足够的以太币
   - 检查网络连接是否正常
   - 确认您有权限执行该操作

2. **文件上传失败**
   - 检查文件大小是否超过限制 (10MB)
   - 确认 Pinata API 密钥配置正确
   - 检查网络连接

3. **内容无法加载**
   - IPFS 网关可能暂时不可用，稍后再试
   - 检查内容哈希是否正确

## 8. 后续改进计划

1. 优化移动端用户体验
2. 添加批量操作功能
3. 实现反馈数据导出功能
4. 支持更多文件类型
5. 集成更多IPFS网关，提高内容加载可靠性 